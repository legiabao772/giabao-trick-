<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AI Dá»± ÄoÃ¡n SunWin</title>
  <style>
    body { background: #111; color: #eee; font-family: Arial, sans-serif; text-align: center; padding: 30px;}
    input, button { padding: 10px; font-size: 16px; margin: 5px;}
    #result { margin-top: 20px; font-size: 18px;}
  </style>
</head>
<body>
  <h1>ğŸ² AI dá»± Ä‘oÃ¡n TÃ i/Xá»‰u</h1>
  <input type="text" id="session" placeholder="Nháº­p mÃ£ phiÃªn (tuá»³ chá»n)" />
  <button onclick="predict()">Dá»± Ä‘oÃ¡n AI</button>
  <div id="result">â³ Chá» dá»¯ liá»‡u & dá»± Ä‘oÃ¡n...</div>

  <script>
   const API_URL = "https://sunwin-taixiu-stream.backend-sunvn30.online/api/SunwinLuckyDice/GetSoiCau";
const TOKEN = "05%2F7JlwSPGwB1fKzi7qXLCUfxG%2F%2FwnP9B3UwDAmuWFLx4HmwqXGCmY2f%2BwVswnATdeJ1hnJUb8JEaXWr%2Bkf3SYji9zW1F5urA9fmlQia331SqlIQmeUS94Mz3ywCtmnj6ssOz4%2BcY91MtHQ1Z5Mchw0tGuI2SZx20zkVqWxbmMPbd8p3UyVQkYqPwgCPexrDhln59UbKBB2akAHlUFDedlcZ0jCROET21tYzOiNB1L36Uz6bWusDsxinaPChHhj4tJokZnWu8NeeDGXWLSeSr%2F00etslH1TXwCrs%2BrD4Dj%2B3OmJ3VlTStVXCEQLMwKvrMdILytS%2FBIYsfAZW%2BMDKlbHbfSbhlyb2jrYRX7ekIiTrO%2BYBr3m%2FKPMS79IxrWixb3geXzgczyY%3D.e90dcc10d9f881cd1b07d25587d93980e2c03e9207a35888e6da3500abcb5fbb";

// Khi fetch:
fetch(`${API_URL}?access_token=${TOKEN}`)

    function extractFeatures(games) {
      const features = [];
      for (let g of games) {
        const dice = [g.FirstDice, g.SecondDice, g.ThirdDice];
        const sum = g.DiceSum;
        const max = Math.max(...dice);
        const min = Math.min(...dice);
        const diff = max - min;
        const avg = sum / 3;
        const unique = new Set(dice).size;
        const isDouble = unique === 2 ? 1 : 0;
        const isTriplet = unique === 1 ? 1 : 0;
        const freq = Array(6).fill(0);
        dice.forEach(d=>freq[d-1]++);
        const most = dice.sort((a,b)=>freq[b-1]-freq[a-1])[0];
        features.push(...dice, sum, max, min, diff, avg, isDouble, isTriplet, most, ...freq);
      }
      return features;
    }

    function statsFromWindow(games) {
      const last10 = games.slice(-10);
      const tx = last10.map(g => g.DiceSum >= 11 ? 1 : 0);
      const taiRatio = tx.filter(x=>x===1).length/10;
      const xiuRatio = 1 - taiRatio;
      const last = tx[tx.length-1];
      const switches = tx.slice(1).filter((v,i)=>v!==tx[i]).length;
      return [taiRatio, xiuRatio, last, switches];
    }

    async function predict() {
      document.getElementById("result").innerText = "â³ Äang phÃ¢n tÃ­ch...";
      try {
        const res = await fetch(`${API_URL}?access_token=${TOKEN}`);
        const data = await res.json();
        const games = data.slice(-20);
        const window = games.slice(-10);
        const feat = extractFeatures(window).concat(statsFromWindow(window));
        const score = feat.reduce((a,b)=>a+b,0)/feat.length + (Math.random()*4 - 2);
        const pred = score >= 85 ? "TÃ i" : "Xá»‰u";
        const rate = Math.round(Math.min(95,Math.max(60,score)));
        const nextSession = Math.max(...games.map(g=>g.SessionID)) + 1;
        document.getElementById("result").innerText =
          `ğŸ”¢ PhiÃªn tiáº¿p: ${nextSession}\nğŸ¯ Dá»± Ä‘oÃ¡n: ${pred}\nğŸ“ˆ XÃ¡c suáº¥t: ${rate}%`;
      } catch(e) {
        document.getElementById("result").innerText = "âŒ Lá»—i khi táº£i dá»¯ liá»‡u tá»« API";
      }
    }
  </script>
</body>
</html>
